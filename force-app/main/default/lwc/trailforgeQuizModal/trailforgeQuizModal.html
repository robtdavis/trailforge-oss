<!--
SPDX-License-Identifier: MIT
TrailForge â€” Open Source under the MIT License
Copyright (c) 2025 Robert Davis
See the LICENSE file in the project root for full license text.
-->
<template>
    <!-- Modal Backdrop -->
    <section if:true={showModal} class={modalSectionClass} role="dialog">
        <div class={modalContainerClass}>
            
            <!-- Modal Header -->
            <header class="slds-modal__header">
                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" 
                        title="Close" 
                        onclick={handleClose}>
                    <lightning-icon icon-name="utility:close" alternative-text="Close" size="small"></lightning-icon>
                    <span class="slds-assistive-text">Close</span>
                </button>
                <h2 class="slds-modal__title slds-hyphenate">{quizTitle}</h2>
                <p class="slds-m-top_x-small">
                    Question {currentQuestionNumber} of {totalQuestions}
                </p>
            </header>

            <!-- Modal Body - Quiz Content -->
            <div class="slds-modal__content slds-p-around_medium" style="min-height: 400px;">
                
                <!-- Loading State -->
                <template if:true={isLoading}>
                    <div style="min-height: 400px; display: flex; align-items: center; justify-content: center;">
                        <lightning-spinner alternative-text="Loading quiz" size="large"></lightning-spinner>
                    </div>
                </template>

                <!-- Error State -->
                <template if:true={error}>
                    <div class="slds-text-color_error slds-text-align_center slds-p-around_large">
                        <lightning-icon icon-name="utility:error" size="medium" variant="error"></lightning-icon>
                        <p class="slds-m-top_small">{error}</p>
                    </div>
                </template>
                
                <!-- Quiz Results (after submission) -->
                <template if:true={showResults}>
                    <div class="slds-p-around_medium">
                        <!-- Result Header -->
                        <div class={resultBoxClass}>
                            <div class="slds-text-align_center">
                                <lightning-icon icon-name={resultIconName} variant={resultIconVariant} size="large"></lightning-icon>
                                <h2 class="slds-text-heading_medium slds-m-top_small">{resultHeading}</h2>
                            </div>
                        </div>
                        
                        <!-- Score Details -->
                        <div class="slds-grid slds-wrap slds-gutters_small slds-m-bottom_medium">
                            <div class="slds-col slds-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-text-align_center">
                                    <div class="slds-text-color_weak slds-text-body_small">Your Score</div>
                                    <div class="slds-text-heading_medium">{quizResult.scorePercent}%</div>
                                </div>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-text-align_center">
                                    <div class="slds-text-color_weak slds-text-body_small">Passing Score</div>
                                    <div class="slds-text-heading_medium">{quizResult.passingScore}%</div>
                                </div>
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-m-top_small">
                                <div class="slds-box slds-box_x-small slds-text-align_center">
                                    <div class="slds-text-color_weak slds-text-body_small">Points Earned</div>
                                    <div class="slds-text-heading_medium">{quizResult.score} / {quizResult.maxScore}</div>
                                </div>
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-m-top_small">
                                <div class="slds-box slds-box_x-small slds-text-align_center">
                                    <div class="slds-text-color_weak slds-text-body_small">Questions</div>
                                    <div class="slds-text-heading_medium">{totalQuestions}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Result Message -->
                        <div class="slds-box slds-text-align_center">
                            <p class="slds-text-body_regular">{quizResult.message}</p>
                        </div>
                    </div>
                </template>

                <!-- Quiz Questions -->
                <template if:true={showQuizQuestions}>
                        <template if:true={hasQuestions}>
                            
                            <!-- Current Question -->
                            <div class="tf-quiz-question">
                                
                                <!-- Question Text -->
                                <h3 class="slds-text-heading_small slds-m-bottom_medium">
                                    {currentQuestion.questionText}
                                </h3>

                                <!-- Answer Choices (Radio Group) -->
                                <lightning-radio-group 
                                    name="answerChoices"
                                    label="Select your answer:"
                                    options={currentQuestion.answerChoices}
                                    value={currentQuestion.selectedAnswerId}
                                    onchange={handleAnswerSelect}
                                    variant="label-hidden">
                                </lightning-radio-group>
                                
                                <!-- Explanation Section (Training Mode Only) -->
                                <template if:true={showingExplanation}>
                                    <div class="slds-box slds-box_x-small slds-theme_info slds-m-top_medium">
                                        <div class="slds-media slds-media_center">
                                            <div class="slds-media__figure">
                                                <lightning-icon icon-name="utility:info" size="small" variant="inverse"></lightning-icon>
                                            </div>
                                            <div class="slds-media__body">
                                                <div class="explanation-content" lwc:dom="manual"></div>
                                            </div>
                                        </div>
                                    </div>
                                </template>

                            </div>

                        </template>

                        <!-- No Questions -->
                        <template if:false={hasQuestions}>
                            <div class="slds-text-align_center slds-p-around_large">
                                <p class="slds-text-color_weak">No questions available for this quiz.</p>
                            </div>
                        </template>

                </template>

            </div>

            <!-- Modal Footer - Navigation / Submit -->
            <footer class="slds-modal__footer">
                
                <!-- Results Footer - Close Button -->
                <template if:true={showResults}>
                    <div class="slds-text-align_center">
                        <button class="slds-button slds-button_brand" onclick={handleClose}>
                            Close
                        </button>
                    </div>
                </template>
                
                <!-- Quiz Footer - Navigation Buttons -->
                <template if:false={showResults}>
                    <div class="slds-grid slds-grid_align-spread">
                    
                    <!-- Previous Button -->
                    <div>
                        <template if:false={isFirstQuestion}>
                            <button class="slds-button slds-button_neutral" 
                                    onclick={handlePrevious}>
                                <lightning-icon icon-name="utility:chevronleft" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                                Previous
                            </button>
                        </template>
                    </div>

                    <!-- Next / Submit Button with Explanation Button -->
                    <div class="slds-button-group">
                        <!-- Show Explanation Button (Training Mode Only) -->
                        <template if:true={canShowExplanation}>
                            <button class="slds-button slds-button_neutral" 
                                    onclick={handleToggleExplanation}>
                                <lightning-icon icon-name="utility:info" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                                <template if:false={showingExplanation}>Show Explanation</template>
                                <template if:true={showingExplanation}>Hide Explanation</template>
                            </button>
                        </template>
                        
                        <template if:false={isLastQuestion}>
                            <button class="slds-button slds-button_brand" 
                                    onclick={handleNext}
                                    disabled={isNextDisabled}>
                                Next
                                <lightning-icon icon-name="utility:chevronright" size="x-small" class="slds-m-left_x-small"></lightning-icon>
                            </button>
                        </template>

                        <template if:true={isLastQuestion}>
                            <button class="slds-button slds-button_success" 
                                    onclick={handleSubmit}
                                    disabled={isSubmitDisabled}>
                                <lightning-icon icon-name="utility:check" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                                Submit Quiz
                            </button>
                        </template>
                    </div>

                    </div>
                </template>
            </footer>

        </div>
    </section>

    <!-- Modal Backdrop Overlay -->
    <div if:true={showModal} class="slds-backdrop slds-backdrop_open"></div>

</template>
